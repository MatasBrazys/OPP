# Game networking protocol

Below is described the wire protocol (message types and structures) used between the Game Server and Client. Messages are newline-delimited JSON objects.

### Transport

-   TCP sockets are used
-   Each JSON message must end with a single \n
-   Each side of the connection MUST parse by reading lines and then decoding JSON

### General structure

-   Every JSON object contains type field - message type identification

## Message Types

### 1. `welcome` (server -> client)

Sent once immediately after the connection is accepted to tell the client its authoritative player id.  
`{`  
`  "type": "welcome",`  
`  "v": 1,`  
`  "id": 42`  
`}`

### 2. `input` (client -> server)

Client's current input (where to move)
`{`  
`  "type": "input",`  
`  "v": 1,`  
`  "dx": -1,` // -1, 0, or 1  
`  "dy": 0,` // -1, 0, or 1  
`}`

\*Think about the client-side prediction to reduce lagginess (do we need it, no?)

### 3. `state` (server -> client)

World state snapshot info, sent on every server tick  
`{`  
`  "type": "state",`  
`  "v": 1,`  
`  "serverTime": 123456789,`  
`  "players": [`  
`    { "id": 42, "x": 210, "y": 120 },`  
`    { "id": 7,  "x": 450, "y": 300 }`  
`  ]`  
`}`

### 4. `ping` / `pong` (either direction)

For liveliness and (if needed) RTT measurement  
`{ "type": "ping", "v": 1, "t": 123456789 }`  
`{ "type": "pong", "v": 1, "t": 123456789 }`

### 5. `goodbye` (server -> client)

Notice from server about connection closing  
`{ "type": "goodbye", "v": 1, "reason": "server_shutdown" }`

### 6. `error` (server -> client)

Error messages  
`{ "type": "error", "v": 1, "code": "bad_message", "detail": "unknown type: foo" }`
